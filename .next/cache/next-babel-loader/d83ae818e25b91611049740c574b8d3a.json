{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\AKIRA\\\\Desktop\\\\web-demo\\\\Project\\\\Frontend-next-js-V1\\\\src\\\\components\\\\SignIn.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useContext } from 'react';\nimport { useMutation } from '@apollo/client';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { useForm, ErrorMessage } from 'react-hook-form';\nimport { useRouter } from 'next/router';\nimport Loader from 'react-loader-spinner';\nimport Modal from './modal/Modal';\nimport { AuthContext } from '../context/AuthContextProvider';\nimport { FormContainer, Header, StyledForm, InputContainer, Input, Button, StyledSwitchAction, Divider, StyledSocial, StyledError } from './SignUp';\nimport { SIGN_IN } from '../apollo/mutations';\nimport { isAdmin } from '../helpers/authHelpers';\n\nvar SignIn = function SignIn() {\n  _s();\n\n  var _error$graphQLErrors$;\n\n  var _useContext = useContext(AuthContext),\n      handleAuthAction = _useContext.handleAuthAction,\n      setAuthUser = _useContext.setAuthUser;\n\n  var _useForm = useForm(),\n      register = _useForm.register,\n      handleSubmit = _useForm.handleSubmit,\n      errors = _useForm.errors;\n\n  var router = useRouter();\n\n  var _useMutation = useMutation(SIGN_IN),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      signin = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      loading = _useMutation2$.loading,\n      error = _useMutation2$.error;\n\n  var handleSignin = handleSubmit( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n      var username, password, _response$data, response, user;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              username = _ref.username, password = _ref.password;\n              _context.prev = 1;\n              _context.next = 4;\n              return signin({\n                variables: {\n                  username: username,\n                  password: password\n                }\n              });\n\n            case 4:\n              response = _context.sent;\n\n              if (response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.signin) {\n                user = response.data.signin; // Close form\n\n                handleAuthAction('close'); // Set auth user in context api\n\n                setAuthUser(user); // Push user to admin page or dashboard page\n\n                if (isAdmin(user)) {\n                  // Push user to their admin page\n                  router.push('/admin');\n                } else {\n                  // Push user to their dashboard page\n                  router.push('/dashboard');\n                }\n              }\n\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              setAuthUser(null);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 8]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  return __jsx(Modal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }, __jsx(FormContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }\n  }, __jsx(Header, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 17\n    }\n  }, __jsx(\"h2\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 21\n    }\n  }, \"Sign In\")), __jsx(StyledSocial, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 17\n    }\n  }, __jsx(\"button\", {\n    className: \"facebook\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 21\n    }\n  }, __jsx(FontAwesomeIcon, {\n    icon: ['fab', 'facebook-f'],\n    size: \"lg\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 25\n    }\n  }), __jsx(\"a\", {\n    href: \"\".concat(process.env.NEXT_PUBLIC_FACEBOOK_LOGIN_URI),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 25\n    }\n  }, \"Log in with Facebook\")), __jsx(\"button\", {\n    className: \"google\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 21\n    }\n  }, __jsx(FontAwesomeIcon, {\n    icon: ['fab', 'google'],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 25\n    }\n  }), __jsx(\"a\", {\n    href: \"\".concat(process.env.NEXT_PUBLIC_GOOGLE_LOGIN_URI),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 25\n    }\n  }, \"Log in with Google\"))), __jsx(Divider, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 17\n    }\n  }), __jsx(StyledForm, {\n    onSubmit: handleSignin,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 17\n    }\n  }, __jsx(\"p\", {\n    className: \"username_section_label\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 21\n    }\n  }, \"or sign in with an username\"), __jsx(InputContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 21\n    }\n  }, __jsx(\"label\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 25\n    }\n  }, \"Username\"), __jsx(Input, {\n    type: \"text\",\n    name: \"Username\",\n    id: \"Username\",\n    placeholder: \"Your Username\",\n    autoComplete: \"new-password\",\n    ref: register({\n      required: 'Username is required.' // pattern: {\n      //   value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\n      //   message: 'Username is in wrong format.',\n      // },\n\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 25\n    }\n  }), __jsx(ErrorMessage, {\n    errors: errors,\n    name: \"username\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 25\n    }\n  }, function (_ref3) {\n    var message = _ref3.message;\n    return __jsx(StyledError, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 47\n      }\n    }, message);\n  })), __jsx(InputContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 21\n    }\n  }, __jsx(\"label\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 25\n    }\n  }, \"Password\"), __jsx(Input, {\n    type: \"password\",\n    name: \"password\",\n    id: \"password\",\n    placeholder: \"Your password\",\n    ref: register({\n      required: 'Password is required.'\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 25\n    }\n  }), __jsx(ErrorMessage, {\n    errors: errors,\n    name: \"password\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 25\n    }\n  }, function (_ref4) {\n    var message = _ref4.message;\n    return __jsx(StyledError, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 47\n      }\n    }, message);\n  })), __jsx(Button, {\n    disabled: loading,\n    style: {\n      cursor: loading ? 'not-allowed' : 'pointer'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 21\n    }\n  }, loading ? __jsx(Loader, {\n    type: \"Oval\",\n    color: \"white\",\n    height: 30,\n    width: 30,\n    timeout: 30000,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 29\n    }\n  }) : 'Submit'), error && __jsx(StyledError, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 25\n    }\n  }, ((_error$graphQLErrors$ = error.graphQLErrors[0]) === null || _error$graphQLErrors$ === void 0 ? void 0 : _error$graphQLErrors$.message) || 'Sorry, something went wrong')), __jsx(StyledSwitchAction, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 17\n    }\n  }, __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 21\n    }\n  }, \"Don't have an account yet?\", ' ', __jsx(\"span\", {\n    style: {\n      cursor: 'pointer',\n      color: 'red'\n    },\n    onClick: function onClick() {\n      return handleAuthAction('signup');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 25\n    }\n  }, \"sign up\"), ' ', \"instead.\"), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 21\n    }\n  }, \"Forgot password? click\", ' ', __jsx(\"span\", {\n    style: {\n      cursor: 'pointer',\n      color: 'red'\n    },\n    onClick: function onClick() {\n      return handleAuthAction('request');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 25\n    }\n  }, \"here.\")))));\n};\n\n_s(SignIn, \"n0ZQkUqoGZcOyhmFVBTYTpvJ8lc=\", false, function () {\n  return [useForm, useRouter, useMutation];\n});\n\n_c = SignIn;\nexport default SignIn;\n\nvar _c;\n\n$RefreshReg$(_c, \"SignIn\");","map":{"version":3,"sources":["C:/Users/AKIRA/Desktop/web-demo/Project/Frontend-next-js-V1/src/components/SignIn.tsx"],"names":["React","useContext","useMutation","FontAwesomeIcon","useForm","ErrorMessage","useRouter","Loader","Modal","AuthContext","FormContainer","Header","StyledForm","InputContainer","Input","Button","StyledSwitchAction","Divider","StyledSocial","StyledError","SIGN_IN","isAdmin","SignIn","handleAuthAction","setAuthUser","register","handleSubmit","errors","router","signin","loading","error","handleSignin","username","password","variables","response","data","user","push","process","env","NEXT_PUBLIC_FACEBOOK_LOGIN_URI","NEXT_PUBLIC_GOOGLE_LOGIN_URI","required","message","cursor","graphQLErrors","color"],"mappings":"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","sourcesContent":["import React, { useContext } from 'react';\r\nimport { useMutation } from '@apollo/client';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useForm, ErrorMessage } from 'react-hook-form';\r\nimport { useRouter } from 'next/router';\r\nimport Loader from 'react-loader-spinner';\r\n\r\nimport Modal from './modal/Modal';\r\nimport { AuthContext } from '../context/AuthContextProvider';\r\nimport {\r\n    FormContainer,\r\n    Header,\r\n    StyledForm,\r\n    InputContainer,\r\n    Input,\r\n    Button,\r\n    StyledSwitchAction,\r\n    Divider,\r\n    StyledSocial,\r\n    StyledError\r\n} from './SignUp';\r\nimport { SigninArgs, User } from '../types';\r\nimport { SIGN_IN } from '../apollo/mutations';\r\nimport { isAdmin } from '../helpers/authHelpers';\r\n\r\ninterface Props {}\r\n\r\nconst SignIn: React.FC<Props> = () => {\r\n    const { handleAuthAction, setAuthUser } = useContext(AuthContext);\r\n    const { register, handleSubmit, errors } = useForm<SigninArgs>();\r\n\r\n    const router = useRouter();\r\n\r\n    const [signin, { loading, error }] = useMutation<{ signin: User }, SigninArgs>(SIGN_IN);\r\n\r\n    const handleSignin = handleSubmit(async ({ username, password }) => {\r\n        try {\r\n            const response = await signin({ variables: { username, password } });\r\n\r\n            if (response?.data?.signin) {\r\n                const user = response.data.signin;\r\n                // Close form\r\n                handleAuthAction('close');\r\n\r\n                // Set auth user in context api\r\n                setAuthUser(user);\r\n\r\n                // Push user to admin page or dashboard page\r\n                if (isAdmin(user)) {\r\n                    // Push user to their admin page\r\n                    router.push('/admin');\r\n                } else {\r\n                    // Push user to their dashboard page\r\n                    router.push('/dashboard');\r\n                }\r\n            }\r\n        } catch (error) {\r\n            setAuthUser(null);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <Modal>\r\n            <FormContainer>\r\n                <Header>\r\n                    <h2>Sign In</h2>\r\n                </Header>\r\n\r\n                <StyledSocial>\r\n                    <button className=\"facebook\">\r\n                        <FontAwesomeIcon icon={['fab', 'facebook-f']} size=\"lg\" />\r\n                        <a href={`${process.env.NEXT_PUBLIC_FACEBOOK_LOGIN_URI}`}>\r\n                            Log in with Facebook\r\n                        </a>\r\n                    </button>\r\n                    <button className=\"google\">\r\n                        <FontAwesomeIcon icon={['fab', 'google']} />\r\n                        <a href={`${process.env.NEXT_PUBLIC_GOOGLE_LOGIN_URI}`}>\r\n                            Log in with Google\r\n                        </a>\r\n                    </button>\r\n                </StyledSocial>\r\n\r\n                <Divider />\r\n\r\n                <StyledForm onSubmit={handleSignin}>\r\n                    <p className=\"username_section_label\">or sign in with an username</p>\r\n\r\n                    <InputContainer>\r\n                        <label>Username</label>\r\n\r\n                        <Input\r\n                            type=\"text\"\r\n                            name=\"Username\"\r\n                            id=\"Username\"\r\n                            placeholder=\"Your Username\"\r\n                            autoComplete=\"new-password\"\r\n                            ref={register({\r\n                                required: 'Username is required.'\r\n                                // pattern: {\r\n                                //   value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\r\n                                //   message: 'Username is in wrong format.',\r\n                                // },\r\n                            })}\r\n                        />\r\n\r\n                        <ErrorMessage errors={errors} name=\"username\">\r\n                            {({ message }) => <StyledError>{message}</StyledError>}\r\n                        </ErrorMessage>\r\n                    </InputContainer>\r\n\r\n                    <InputContainer>\r\n                        <label>Password</label>\r\n\r\n                        <Input\r\n                            type=\"password\"\r\n                            name=\"password\"\r\n                            id=\"password\"\r\n                            placeholder=\"Your password\"\r\n                            ref={register({\r\n                                required: 'Password is required.'\r\n                            })}\r\n                        />\r\n\r\n                        <ErrorMessage errors={errors} name=\"password\">\r\n                            {({ message }) => <StyledError>{message}</StyledError>}\r\n                        </ErrorMessage>\r\n                    </InputContainer>\r\n\r\n                    <Button\r\n                        disabled={loading}\r\n                        style={{ cursor: loading ? 'not-allowed' : 'pointer' }}>\r\n                        {loading ? (\r\n                            <Loader\r\n                                type=\"Oval\"\r\n                                color=\"white\"\r\n                                height={30}\r\n                                width={30}\r\n                                timeout={30000}\r\n                            />\r\n                        ) : (\r\n                            'Submit'\r\n                        )}\r\n                    </Button>\r\n\r\n                    {error && (\r\n                        <StyledError>\r\n                            {error.graphQLErrors[0]?.message || 'Sorry, something went wrong'}\r\n                        </StyledError>\r\n                    )}\r\n                </StyledForm>\r\n                <StyledSwitchAction>\r\n                    <p>\r\n                        Don't have an account yet?{' '}\r\n                        <span\r\n                            style={{ cursor: 'pointer', color: 'red' }}\r\n                            onClick={() => handleAuthAction('signup')}>\r\n                            sign up\r\n                        </span>{' '}\r\n                        instead.\r\n                    </p>\r\n                    <p>\r\n                        Forgot password? click{' '}\r\n                        <span\r\n                            style={{ cursor: 'pointer', color: 'red' }}\r\n                            onClick={() => handleAuthAction('request')}>\r\n                            here.\r\n                        </span>\r\n                    </p>\r\n                </StyledSwitchAction>\r\n            </FormContainer>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default SignIn;\r\n"]},"metadata":{},"sourceType":"module"}